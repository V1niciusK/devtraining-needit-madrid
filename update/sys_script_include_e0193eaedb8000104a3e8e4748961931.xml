<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_58872_needit.validateFields</api_name>
        <client_callable>true</client_callable>
        <description/>
        <name>validateFields</name>
        <script><![CDATA[var validateFields = Class.create();
validateFields.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
	
	clientValidationCall: function () {
		var dataToValidate = this.getParameter('sysparm_toValidate');
		var validationMethod = this.getParameter('sysparm_method');
		var answer = '';
		if (validationMethod == 'phone'){
			answer = this.validatePhone(dataToValidate);
		}else if (validationMethod == 'cep') {
			answer = this.validateCEP(dataToValidate);
		}else if (validationMethod == 'cnpj') {
			answer = this.validateCNPJ(dataToValidate);
		}
		return answer;
	},
	
	validatePhone: function (phoneIn) {

		var phone = phoneIn.toString();
		var phoneOut = '';
		var phoneCln = '';
		var mensagem = '';

		var regexpLLL = /^\(\d\d\)\s\d{4}-\d{4}$/;              //Brazillian local land line regex
		var regexpILL = /^\+\d\d\s\(\d\d\)\s\d{4}-\d{4}$/;      //International land line regex
		var regexpLCP = /^\(\d\d\)\s\d{5}-\d{4}$/;              //Brazillian local cellphone
		var regexpICP = /^\+\d\d\s\(\d\d\)\s\d{5}-\d{4}$/;      //International cellphone
		var regexpCln = /\D/g;

		if (!(regexpLLL.test(phone) || regexpILL.test(phone) || regexpLCP.test(phone) || regexpICP.test(phone))){
			phoneCln = phone.replace(regexpCln,'');
			if (phoneCln.length<9 || phoneCln.length>14){
				mensagem = "Por favor inserir o número no formato (XX) XXXX-XXXX, (XX) XXXXX-XXXX, +XX (XX) XXXX-XXXX ou +XX (XX) XXXXX-XXXX.";
				return mensagem;
			} else {
				var phoneLength = phoneCln.length;
				switch(phoneLength){
					case 10:
						phoneOut = "(" + phoneCln.substring(0,2) + ") " + phoneCln.substring(2,6) + "-" + phoneCln.substring(6,10);
						break;
					case 11:
						phoneOut = "(" + phoneCln.substring(0,2) + ") " + phoneCln.substring(2,7) + "-" + phoneCln.substring(7,11);
						break;
					case 12:
						phoneOut = "+" + phoneCln.substring(0,2) + " (" + phoneCln.substring(2,4) + ") " + phoneCln.substring(4,8) + "-" + phoneCln.substring(8,12);
						break;
					case 13:
						phoneOut = "+" + phoneCln.substring(0,2) + " (" + phoneCln.substring(2,4) + ") " + phoneCln.substring(4,9) + "-" + phoneCln.substring(9,13);
						break;
				}
				return phoneOut;
			}
		}

	},
	
	validateCEP: function (cepIn) {

		var cep = cepIn.toString();
		var cepOut = '';
		var cepCln = '';
		var mensagem = '';

		var regexpCEP = /^\d{5}-\d{3}$/g; //formato XXXXX-XXX
		var regexpCln = /\D/g;

		if (!regexpCEP.test(cep)) {
			cepCln = cep.replace(regexpCln,'');
			if (cepCln.length != 8) {
				mensagem = "CEP no formato incorreto, por favor insira um CEP com 8 dígitos";
				return mensagem;
			} else {
				cepOut = cepCln.substring(0,5) + "-" + cepCln.substring(5,8);
				return cepOut;
			}
		}

	},
	
	validateCNPJ: function(cnpjIn) {
		
		var cnpj = cnpjIn.toString();
		var cnpjOut = '';
		var cnpjCln = '';
		var mensagem = '';
		
		var regexp = /^\d\d\.\d{3}\.\d{3}\/\d{4}-\d\d$/g;
		var regexpCln = /\D/g;
		
		if (!regexp.test(cnpj)) {
			cnpjCln = cnpj.replace(regexpCln, '');
			
			if (cnpjCln.length != 14){
				mensagem = "CNPJ no formato incorreto, por favor insira um cnpj com 14 dígitos";
				return mensagem;
			}else {
				cnpjOut = cnpjCln.substring(0,2) + "." + cnpjCln.substring(2,5) + "." + cnpjCln.substring(5,8) + "/" + cnpjCln.substring(8,12) + "-" + cnpjCln.substring(12,14);
				return cnpjOut;
			}
		}
	},
	
    type: 'validateFields'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-25 18:56:32</sys_created_on>
        <sys_id>e0193eaedb8000104a3e8e4748961931</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_name>validateFields</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_script_include_e0193eaedb8000104a3e8e4748961931</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-26 19:43:25</sys_updated_on>
    </sys_script_include>
</record_update>
